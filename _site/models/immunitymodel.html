<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.1.189">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>COVID IBM: Waning Immunity - Immunity model</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1.6em;
  vertical-align: middle;
}
div.csl-bib-body { }
div.csl-entry {
  clear: both;
}
.hanging div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}
</style>


<script src="../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../site_libs/clipboard/clipboard.min.js"></script>
<script src="../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../site_libs/quarto-search/fuse.min.js"></script>
<script src="../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../">
<script src="../site_libs/quarto-html/quarto.js"></script>
<script src="../site_libs/quarto-html/popper.min.js"></script>
<script src="../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../site_libs/quarto-html/anchor.min.js"></script>
<link href="../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit"
  }
}</script>

  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<link rel="stylesheet" href="../styles.css">
</head>

<body class="nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg navbar-dark ">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container">
    <a class="navbar-brand" href="../index.html">
    <span class="navbar-title">COVID IBM: Waning Immunity</span>
    </a>
  </div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item">
    <a class="nav-link" href="../index.html">Home</a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../models/transmission.html">Transmission Model</a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../models/clinicaloutcomes.html">Clinical Outcomes Model</a>
  </li>  
  <li class="nav-item">
    <a class="nav-link active" href="../models/immunitymodel.html" aria-current="page">Immunity Model</a>
  </li>  
</ul>
              <div id="quarto-search" class="" title="Search"></div>
          </div> <!-- /navcollapse -->
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Immunity model</h1>
</div>



<div class="quarto-title-meta">

    
    
  </div>
  

</header>

<!-- Define all your latex macros within an equation environment -->
<p><span class="math display">\[
\newcommand{ICU}{\text{ICU}}
\]</span> Within both the <a href="../models/transmission.html">transmission model</a> and the <a href="../models/clinicaloutcomes.html">clinical outcomes model</a> we include an immunological response to COVID-19. This immunological response is handled by directly modelling each individual’s neutralising antibody titre. By using the model of <span class="citation" data-cites="Khoury2021">Khoury et al. (<a href="#ref-Khoury2021" role="doc-biblioref">2021</a>)</span> and <span class="citation" data-cites="Cromer2022">Cromer et al. (<a href="#ref-Cromer2022" role="doc-biblioref">2022</a>)</span> we can relate an individual’s neutralising antibody titre to their protection against all outcomes of interest: infection, symptomatic disease, onward transmission given breakthrough infection, hospitalisation and death. The fact that each individual is assigned their own neutralising antibody titre results in inter-individual variation that leads to varying distributions of protection throughout the community, impacting the resulting dynamics. In the Australian context, by the time Delta and Omicron outbreaks occurred almost all immunity was vaccine-derived, therefore the model is initialised by considering neutralisating antibody titre from the vaccine roll out alone.</p>
<p>An individual’s neutralising antibody titre can be increased by a variety of exposures. The processes that we consider are: the first, second and booster dose of a vaccine, or infection occurring in an unvaccinated or vaccinated individual. Note that for simplicity we assume that infection prior to or following vaccination results in the same titre of neutralising antibody. Immune responses are stratified by the type of vaccine product, AstraZeneca (AZ) or mRNA vaccine (Pfizer or Moderna), that the individual has received based on supply and distribution data.</p>
<p>At the time of a boosting process, we sample the level of neutralising antibody titre that is acquired from, <span class="math display">\[
    \log_{10}(a_i^0) \sim \mathcal{N}(\mu^x_j, \sigma^2),
\]</span> where <span class="math inline">\(a_i^0\)</span> is the neutralising antibody titre that individual <span class="math inline">\(i\)</span> is boosted to, <span class="math inline">\(\mu^x_j\)</span> is the mean neutralising antibody titre against strain <span class="math inline">\(x\)</span> of the population after boosting process <span class="math inline">\(j\)</span> and <span class="math inline">\(\sigma^2\)</span> is the variance of neutralising antibodies across the population.</p>
<p>The mean neutralising antibody titre, <span class="math inline">\(\mu^x_j\)</span>, is set using logical rules based upon the infection and vaccination history of the individual. In our work it is assumed that an unvaccinated individual will have an average neutralising antibody titre of 0.0 on the <span class="math inline">\(\log_{10}\)</span>-scale after exposure. This is our baseline measurement and is used to calibrate across multiple neutralising antibody studies. For an individual that has no prior exposure to COVID-19, their vaccination induces an antibody response such that, <span id="eq-meanneuts"><span class="math display">\[
    \mu^x_j = \mu_j^0 + \log_{10}(f_x),
\tag{1}\]</span></span> where <span class="math inline">\(\mu_j^0\)</span> is the mean level of neutralising antibody titre for vaccine <span class="math inline">\(j\)</span> against a base strain of COVID-19 (for us this is Delta) and <span class="math inline">\(f_x\)</span> is the fold change in neutralising antibody titre between the base strain and strain <span class="math inline">\(x\)</span>. To account for the effect of exposure to COVID-19 prior or post vaccination, we use an altered form of <a href="#eq-meanneuts">Equation&nbsp;1</a>. For brevity, we have used <a href="#tbl-ExposedEquations">Table&nbsp;1</a> to list the equations used to obtain <span class="math inline">\(\mu^x_j\)</span> with infection rather than include a description within text<a href="#fn1" class="footnote-ref" id="fnref1" role="doc-noteref"><sup>1</sup></a>.</p>
<div id="tbl-ExposedEquations" class="anchored">
<table class="table">
<caption>Table&nbsp;1: Presented here are the relationships assumed within our immunological model for neutralising antibody titre for individuals that have been exposed to COVID-19. Here we have used the extended subscript with an E to represent prior or current exposure to the circulating strain of COVID-19.</caption>
<colgroup>
<col style="width: 61%">
<col style="width: 38%">
</colgroup>
<thead>
<tr class="header">
<th style="text-align: center;">Processes</th>
<th style="text-align: center;">Average titre formula</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: center;">Unvaccinated (U<span class="math inline">\(\cap\)</span>E)</td>
<td style="text-align: center;"><span class="math inline">\(\mu^x_{\text{U}\cap\text{E}} = \mu^0_\text{U}\)</span></td>
</tr>
<tr class="even">
<td style="text-align: center;">AZ dose 1 (AZ1<span class="math inline">\(\cap\)</span>E)</td>
<td style="text-align: center;"><span class="math inline">\(\mu^x_{\text{AZ1}\cap\text{E}} = \mu_{\text{P2}}^0\)</span></td>
</tr>
<tr class="odd">
<td style="text-align: center;">AZ dose 2 (AZ2<span class="math inline">\(\cap\)</span>E)</td>
<td style="text-align: center;"><span class="math inline">\(\mu^x_{\text{AZ2}\cap\text{E}} = \mu_{\text{B}}^0\)</span></td>
</tr>
<tr class="even">
<td style="text-align: center;">Pfizer dose 1 (P1<span class="math inline">\(\cap\)</span>E)</td>
<td style="text-align: center;"><span class="math inline">\(\mu^x_{\text{P1}\cap\text{E}} = \mu_{\text{P2}}^0\)</span></td>
</tr>
<tr class="odd">
<td style="text-align: center;">Pfizer dose 2 (P2<span class="math inline">\(\cap\)</span>E)</td>
<td style="text-align: center;"><span class="math inline">\(\mu^x_{\text{P2}\cap\text{E}} = \mu_{\text{B}}^0\)</span></td>
</tr>
<tr class="even">
<td style="text-align: center;">mRNA booster (B<span class="math inline">\(\cap\)</span>E)</td>
<td style="text-align: center;"><span class="math inline">\(\mu^x_{\text{B}\cap\text{E}} = \mu_{\text{B}}^0\)</span></td>
</tr>
</tbody>
</table>
</div>
<p>It is assumed that an individual’s titre of neutralising antibodies will decay after boosting. This decay is assumed to be exponential, therefore, <span id="eq-NeutDecay"><span class="math display">\[
    \log_{10}(a_i) = \log_{10}(a_i^0) -
         \frac{k_a}{\log(10.0)}t,
\tag{2}\]</span></span> where <span class="math inline">\(a_i\)</span> is the time dependent neutralising antibody titre of individual <span class="math inline">\(i\)</span>, <span class="math inline">\(k_a\)</span> is the decay rate of neutralising antibodies and <span class="math inline">\(t\)</span> is the time from the last boosting process (to limit the computational cost of constantly converting neutralising antibodies, all equations are expressed in terms of <span class="math inline">\(\log_{10}(a_i)\)</span> in our work).</p>
<p>To convert the neutralising antibody titre of an individual to their protection against any disease outcome, <span class="math inline">\(\rho_\alpha\)</span>, we use <span id="eq-ProtectionCurve"><span class="math display">\[
    \rho_\alpha = \frac{1}{1 + \exp(-k (\log_{10}(a_i) - c_{\alpha}))}
\tag{3}\]</span></span> where <span class="math inline">\(k\)</span> is governs the steepness of the logistic curve (logistic growth rate), and <span class="math inline">\(c_{\alpha}\)</span> defines the midpoint of the logistic function for disease outcome <span class="math inline">\(\alpha\)</span>.</p>
<p>The immunological model interacts with the transmission model by altering the probability that an individual develops symptoms, <span class="math inline">\(q_i\)</span>, their rate of onward transmission given breakthrough infection, <span class="math inline">\(\tau_i\)</span>, and the contact’s level of susceptibility, <span class="math inline">\(\xi_j\)</span>.</p>
<p>The susceptibility of contact <span class="math inline">\(j\)</span> is, <span class="math display">\[
    \xi_j = (1-\rho_\xi)\xi^0_i,
\]</span> where <span class="math inline">\(\rho_\xi\)</span> is the protection against infection and <span class="math inline">\(\xi_i^0\)</span> is the susceptibility of the <span class="math inline">\(i\)</span>th individual if they were completely COVID naive. The probability that individual <span class="math inline">\(i\)</span> develops symptoms is governed by, <span id="eq-symptomaticinfection"><span class="math display">\[
    q_i = \frac{1 - \rho_q}{1 - \rho_\xi}q_i^0,
\tag{4}\]</span></span> where <span class="math inline">\(\rho_q\)</span> is the protection against symptomatic infection and <span class="math inline">\(q_i^0\)</span> is the probability of symptomatic infection for individual <span class="math inline">\(i\)</span> if they were completely COVID naive (zero neutralising antibody titre).</p>
<p>To model the onward transmission rate more care must be taken. It is assumed in our model that asymptomatic individuals are 50% less likely to infect their contacts when compared to their symptomatic counterpart. However, this reduction in transmission due to asymptomatic infections is not accounted for in the clinical trial data used to calibrate the protection against onward transmission. To avoid double counting the effect of the neutralising antibodies we alter the functional form for the rate of onward transmission to, <span id="eq-onwardtransmission"><span class="math display">\[
    \tau_i = \frac{s(1 - \rho_\tau)(1 + q_i^0)}{1+ q_i} \beta_i,
\tag{5}\]</span></span> where <span class="math inline">\(s\)</span> is either 0.5 or 1 depending upon whether the individual is asymptomatic or symptomatic respectively, <span class="math inline">\(\rho_\tau\)</span> is the protection against onward transmission and <span class="math inline">\(\beta_i\)</span> is the baseline (zero neutralising antibody titre) infectiousness of the infector. Note that <span class="math inline">\(\beta_i\)</span> depends upon the age of the individual and the expected transmission potential of the population.</p>
<p>To reduce the computational cost of updating the immunological component of the transmission model for each individual at every timestep, we only solve the immunological component of the IBM when we require the protection against an outcome of interest. This is done by storing the time of last boost of neutralising antibodies and the titre that the individual was boosted to. When required, we update the individual’s neutralising antibody titre to the current timestep using this stored information.</p>
<p>The clinical outcomes model uses the transmission model as an intermediary between the immunological response of each infected individual and their corresponding clinical outcome. This is done by outputting each infected individual’s neutralising antibody titre at the point of exposure, a symptom indicator and their time of symptom onset for use within the clinical pathways model.</p>
<p>The immunological model determines the probability of hospitalisation, ICU requirement and death based on observed relationships between neutralising antibody titres and clinical endpoint outcomes from efficacy studies. For a symptomatic individual <span class="math inline">\(i\)</span>, the probability of hospitalisation is given by <span class="math display">\[
    p_{H | I }^i = \frac{OR\left(p^0_{H|E},\rho_h(a_i)\right)}{q_i},
\]</span> where <span class="math inline">\(p^0_{H|E}\)</span> is the baseline probability of hospitalisation given infection, <span class="math inline">\(\rho_h(a_i)\)</span> is the protection against hospitalisation, <span class="math inline">\(a_i\)</span> is individual <span class="math inline">\(i\)</span>’s neutralising antibody titre at the point of exposure, and <span class="math display">\[
OR(p,r)= \frac{\frac{rp}{p-1}}{1+\frac{rp}{1-p}},
\]</span> is the function that uses odds ratio <span class="math inline">\(r\)</span> and baseline probability <span class="math inline">\(p\)</span> to compute an adjusted probability.</p>
<p>If individual <span class="math inline">\(i\)</span> is hospitalised, the probabilities governing which hospital pathway is chosen are altered such that, <span class="math display">\[
p_{\ICU | H}^i = \frac{OR\left(p^0_{\ICU| E} ,\rho_h(a_i)\right)}{p_{H| I }^iq_i},
\]</span> and, <span class="math display">\[
    p_{H_D|ICU^c}^i = \frac{OR\left(p^0_{H_D|E},\rho_\text{D}(a_i)\right)}{(1-p_{\ICU | H}^i)p_{H | I}^iq_i},
\]</span> where <span class="math inline">\(p^0_{\ICU | E}\)</span> is the baseline probability of requiring the ICU given infection, <span class="math inline">\(p_{H_D|E}^0\)</span> is the probability of death on ward (without visiting ICU) given infection and <span class="math inline">\(\rho_\text{D}(a_i)\)</span> is the protection against death given infection.</p>
<p>If individual <span class="math inline">\(i\)</span> is in the ICU, then their probabilities of death in the ICU, <span class="math inline">\(p_{\ICU_D|\ICU}^i\)</span>, and death on the ward given they left ICU without dying, <span class="math inline">\(p_{W_D|\ICU_D^c}^i\)</span>, are altered such that, <span class="math display">\[
    p_{\ICU_D|\ICU}^i = \frac{OR\left(p^0_{\ICU_D|E},\rho_\text{D}(a_i)\right)}{p_{\ICU | H}^ip_{H| I }^iq_i},
\]</span> and, <span class="math display">\[
    p_{W_D|\ICU_D^c}^i = \frac{OR\left(p_{W_D|E}^0,\rho_D(a_i)\right)}{(1-p_{\ICU_D|\ICU}^i)p_{\ICU | H}^ip_{H | I }^iq_i},
\]</span> where <span class="math inline">\(p^0_{\ICU_D|E}\)</span> is the baseline probability of dying in the ICU and <span class="math inline">\(p_{W_D|E}^0\)</span> is the baseline probability of dying in the ward after returning from the ICU. Note that we assume no difference between the protection from hospitalisation given infection and the protection from ICU given infection here.</p>
<p>To determine all parameters in <a href="#eq-NeutDecay">Equation&nbsp;2</a> and <a href="#eq-ProtectionCurve">Equation&nbsp;3</a>, we use a re-implementation of <span class="citation" data-cites="Khoury2021">Khoury et al. (<a href="#ref-Khoury2021" role="doc-biblioref">2021</a>)</span> and <span class="citation" data-cites="Cromer2022">Cromer et al. (<a href="#ref-Cromer2022" role="doc-biblioref">2022</a>)</span> in a Bayesian framework <span class="citation" data-cites="GoldingNeuts2022">(<a href="#ref-GoldingNeuts2022" role="doc-biblioref">Golding 2022</a>)</span>. This allows us to calibrate the level of protection, which is analogous to vaccine efficacy for individuals with no exposure to COVID-19, to observed clinical data. The model fit in <span class="citation" data-cites="GoldingNeuts2022">Golding (<a href="#ref-GoldingNeuts2022" role="doc-biblioref">2022</a>)</span> takes in a range of data relating neutralising antibody levels to efficacy, and estimates of vaccine efficacies from a range of studies to estimate efficacy over time against the Delta variant. To estimate the efficacies against the Omicron variant, Golding and colleagues estimate an ‘escape’ parameter for the Omicron variant relative to the Delta variant. This was done by using the relative rates of infection in Danish households between Omicron and Delta to estimate the the relative <span class="math inline">\(R_0\)</span> between the variants, and early evidence of vaccine efficacies against Omicron from the UK to understand the level of vaccine escape. This was then combined with the information fit on the Delta variant to model waning over time for both the Delta and Omicron variants.</p>





<div id="quarto-appendix" class="default"><section class="quarto-appendix-contents" role="doc-bibliography"><h2 class="anchored quarto-appendix-heading">References</h2><div id="refs" class="references csl-bib-body hanging-indent" role="doc-bibliography">
<div id="ref-Cromer2022" class="csl-entry" role="doc-biblioentry">
Cromer, Deborah, Megan Steain, Arnold Reynaldi, Timothy E. Schlub, Adam K. Wheatley, Jennifer A. Juno, Stephen J. Kent, James A. Triccas, David S. Khoury, and Miles P. Davenport. 2022. <span>“Neutralising Antibody Titres as Predictors of Protection Against <span>SARS</span>-<span>CoV</span>-2 Variants and the Impact of Boosting: A Meta-Analysis.”</span> <em>The Lancet Microbe</em> 3 (1): e52–61. <a href="https://doi.org/10.1016/S2666-5247(21)00267-6">https://doi.org/10.1016/S2666-5247(21)00267-6</a>.
</div>
<div id="ref-GoldingNeuts2022" class="csl-entry" role="doc-biblioentry">
Golding, Nick. 2022. <span>“Neuts2efficacy.”</span> <a href="https://github.com/goldingn/neuts2efficacy">https://github.com/goldingn/neuts2efficacy</a>.
</div>
<div id="ref-Khoury2021" class="csl-entry" role="doc-biblioentry">
Khoury, David S., Deborah Cromer, Arnold Reynaldi, Timothy E. Schlub, Adam K. Wheatley, Jennifer A. Juno, Kanta Subbarao, Stephen J. Kent, James A. Triccas, and Miles P. Davenport. 2021. <span>“Neutralizing Antibody Levels Are Highly Predictive of Immune Protection from Symptomatic <span>SARS</span>-<span>CoV</span>-2 Infection.”</span> <em>Nature Medicine</em> 27 (7): 1205–11. <a href="https://doi.org/10.1038/s41591-021-01377-8">https://doi.org/10.1038/s41591-021-01377-8</a>.
</div>
</div></section><section id="footnotes" class="footnotes footnotes-end-of-document" role="doc-endnotes"><h2 class="anchored quarto-appendix-heading">Footnotes</h2>

<ol>
<li id="fn1"><p>These formulae are updated as information continues to evolve.<a href="#fnref1" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
</ol>
</section></div></main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    target: function(trigger) {
      return trigger.previousElementSibling;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    setTimeout(function() {
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const cites = ref.parentNode.getAttribute('data-cites').split(' ');
    tippyHover(ref, function() {
      var popup = window.document.createElement('div');
      cites.forEach(function(cite) {
        var citeDiv = window.document.createElement('div');
        citeDiv.classList.add('hanging-indent');
        citeDiv.classList.add('csl-entry');
        var biblioDiv = window.document.getElementById('ref-' + cite);
        if (biblioDiv) {
          citeDiv.innerHTML = biblioDiv.innerHTML;
        }
        popup.appendChild(citeDiv);
      });
      return popup.innerHTML;
    });
  }
});
</script>
</div> <!-- /content -->



</body></html>